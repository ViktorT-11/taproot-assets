-- Rename the table to align with "supply" terminology.
ALTER TABLE mint_anchor_uni_commitments
    RENAME TO mint_supply_pre_commits;

-- Add a new table to track supply pre-commitments generated by
CREATE TABLE supply_pre_commits (
    id INTEGER PRIMARY KEY,

    -- The asset group key for this supply pre-commitment.
    -- Stored in canonical 32-byte x-only form as defined in BIP340
    -- (schnorr.SerializePubKey).
    group_key BLOB NOT NULL CHECK(length(group_key) = 32),

    -- The taproot internal key of the pre-commitment transaction output.
    taproot_internal_key BLOB NOT NULL CHECK(length(taproot_internal_key) = 33),

    -- The pre-commit outpoint from the mint anchor transaction.
    outpoint BLOB NOT NULL CHECK(length(outpoint) > 0),

    -- The chain transaction that included this pre-commitment output.
    chain_txn_db_id BIGINT NOT NULL REFERENCES chain_txns(txn_id),

    -- Reference to supply commitment which spends this pre-commitment.
    spent_by BIGINT REFERENCES supply_commitments(commit_id)
);

-- Create a unique index on outpoint.
CREATE UNIQUE INDEX supply_pre_commits_unique_outpoint
    ON supply_pre_commits(outpoint);

-- Create an index on group_key for faster lookups.
CREATE INDEX supply_pre_commits_idx_group_key
    ON supply_pre_commits(group_key);
